<!doctype html>
<html lang="ru" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ö–≤–µ—Å—Ç: –ü–µ—á–æ—Ä–∏–Ω</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <style>
    body { box-sizing: border-box; }
    .font-display { font-family: 'Playfair Display', serif; }
    .font-body { font-family: 'Montserrat', sans-serif; }
    
    @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-10px) rotate(2deg); } }
    @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(234, 179, 8, 0.3); } 50% { box-shadow: 0 0 40px rgba(234, 179, 8, 0.6); } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    
    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-glow { animation: glow 2s ease-in-out infinite; }
    .animate-slide-in { animation: slideIn 0.5s ease-out forwards; }
    
    .mountain-bg { background: linear-gradient(180deg, #1a1a2e 0%, #16213e 30%, #0f3460 60%, #533483 100%); }
    .duel-bg { background: linear-gradient(180deg, #2d1b0e 0%, #5c3d2e 30%, #8b6914 60%, #d4a574 100%); }
    .city-bg { background: linear-gradient(180deg, #1a0a2e 0%, #2d1b69 30%, #5b2c6f 60%, #f39c12 100%); }
    .word-chip { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .progress-bar { background: linear-gradient(90deg, #eab308, #f59e0b); }
  </style>
</head>
<body class="h-full font-body text-white">
  <div id="app" class="h-full w-full overflow-auto"></div>

  <script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ê FIREBASE ---
    // –ó–ê–ú–ï–ù–ò –≠–¢–ò –î–ê–ù–ù–´–ï –Ω–∞ —Å–≤–æ–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ Firebase (Project Settings -> General -> Your Apps)
    const firebaseConfig = {
  apiKey: "AIzaSyAG5DU2VJR_8FjBUs6ZkHJ90FGmB05RP_Q",
  authDomain: "pechorin-quest.firebaseapp.com",
  databaseURL: "https://pechorin-quest-default-rtdb.firebaseio.com", // –ø—Ä–æ–≤–µ—Ä—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É!
  projectId: "pechorin-quest",
  storageBucket: "pechorin-quest.firebasestorage.app",
  messagingSenderId: "234397373581",
  appId: "1:234397373581:web:f1b9b72f55939ad85d7ec4",
  measurementId: "G-TR56QES3EP"
};


    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // --- –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ---
    let currentUser = null;
    let completedEpisodes = [];
    let leaderBoardData = [];

    const config = {
      game_title: '–û—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ö–≤–µ—Å—Ç',
      primary_action_color: '#eab308',
      surface_color: '#2d2d44',
      text_color: '#f5f5f5'
    };

    // –î–∞–Ω–Ω—ã–µ —ç–ø–∏–∑–æ–¥–æ–≤ (–æ—Å—Ç–∞–≤–∏–ª –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
    const episodes = [
      { id: 1, title: '–¢—Ä—ç—à –Ω–∞ –ö–∞–≤–∫–∞–∑–µ', location: '–ì–æ—Ä–Ω–æ–µ —É—â–µ–ª—å–µ', bgClass: 'mountain-bg', icon: 'üèîÔ∏è', originalText: '–ù—É –∏ –¥–≤–∏–∂ —Ç—É—Ç, –ø—Ä–æ—Å—Ç–æ —Ç—Ä—ç—à. –≠—Ç–∏ –≥–æ—Ä—Ü—ã ‚Äî –≤–æ–æ–±—â–µ —Ç–æ–ø—á–∏–∫!', correctText: '–ù—É –∏ –¥–≤–∏–∂–µ–Ω–∏–µ —Ç—É—Ç, –ø—Ä–æ—Å—Ç–æ —É–∂–∞—Å. –≠—Ç–∏ –≥–æ—Ä—Ü—ã ‚Äî –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–µ!', words: [{ slang: '–¥–≤–∏–∂', correct: '–¥–≤–∏–∂–µ–Ω–∏–µ', options: ['–¥–≤–∏–∂–µ–Ω–∏–µ', '–¥–≤–∏–∂—É—Ö–∞', '–¥–≤–∏–≥–∞—Ç–µ–ª—å'] }, { slang: '—Ç—Ä—ç—à', correct: '—É–∂–∞—Å', options: ['—É–∂–∞—Å', '–º—É—Å–æ—Ä', '—Ç—Ä–µ—â–∏–Ω–∞'] }, { slang: '—Ç–æ–ø—á–∏–∫', correct: '–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–µ', options: ['–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–µ', '–≤–µ—Ä—à–∏–Ω–∞', '—Ç–æ–ø–æ—Ä'] }] },
      { id: 2, title: '–ò–∑–∏ –¥—É—ç–ª—å', location: '–ü–æ–ª–µ –¥–ª—è –¥—É—ç–ª–∏', bgClass: 'duel-bg', icon: '‚öîÔ∏è', originalText: '–ù—É —á—ë, –¥—É—ç–ª—å –±—É–¥–µ—Ç –∏–∑–∏, —è –∂–µ –∫—Ä–∞—à –≤—Å–µ—Ö –¥–∞–º!', correctText: '–ù—É —á—Ç–æ –∂, –¥—É—ç–ª—å –±—É–¥–µ—Ç –ª—ë–≥–∫–æ–π, —è –∂–µ –ª—é–±–∏–º–µ—Ü –≤—Å–µ—Ö –¥–∞–º!', words: [{ slang: '—á—ë', correct: '—á—Ç–æ –∂', options: ['—á—Ç–æ –∂', '—á–µ–≥–æ', '—á–µ–π'] }, { slang: '–∏–∑–∏', correct: '–ª—ë–≥–∫–æ–π', options: ['–ª—ë–≥–∫–æ–π', '–ª–µ–≥–∫–æ', '–ª—ë–≥–∫–∏–π'] }, { slang: '–∫—Ä–∞—à', correct: '–ª—é–±–∏–º–µ—Ü', options: ['–ª—é–±–∏–º–µ—Ü', '–∫—Ä—É—à–µ–Ω–∏–µ', '–∫—Ä–∞—Å–∞–≤–µ—Ü'] }] },
      { id: 3, title: '–§–ª–µ–∫—Å –≤ –ú–∞—Ö–∞—á–∫–∞–ª–µ', location: '–®—É–º–Ω–∞—è —É–ª–∏—Ü–∞ –≥–æ—Ä–æ–¥–∞', bgClass: 'city-bg', icon: 'üåÜ', originalText: '–≠—Ç–∏ –ª—é–¥–∏ ‚Äî –ø–æ–ª–Ω—ã–π —Ñ–ª–µ–∫—Å, –∂–∏–≤—É—Ç –∫–∞–∫ —Ö–∞–π–ø–æ–≤—ã–µ —Ç–∏–∫—Ç–æ–∫–µ—Ä—ã!', correctText: '–≠—Ç–∏ –ª—é–¥–∏ ‚Äî –ø–æ–ª–Ω–æ–µ –≤–µ—Å–µ–ª—å–µ, –∂–∏–≤—É—Ç –∫–∞–∫ –º–æ–¥–Ω–∏–∫–∏!', words: [{ slang: '—Ñ–ª–µ–∫—Å', correct: '–≤–µ—Å–µ–ª—å–µ', options: ['–≤–µ—Å–µ–ª—å–µ', '–≥–∏–±–∫–æ—Å—Ç—å', '—Ñ–ª–∞–≥'] }, { slang: '—Ö–∞–π–ø–æ–≤—ã–µ', correct: '–º–æ–¥–Ω—ã–µ', options: ['–º–æ–¥–Ω—ã–µ', '–≤—ã—Å–æ–∫–∏–µ', '—Ö–∏—Ç—Ä—ã–µ'] }, { slang: '—Ç–∏–∫—Ç–æ–∫–µ—Ä—ã', correct: '–º–æ–¥–Ω–∏–∫–∏', options: ['–º–æ–¥–Ω–∏–∫–∏', '—Ç–∞–Ω—Ü–æ—Ä—ã', '–±–ª–æ–≥–µ—Ä—ã'] }], proverb: { full: '–°–ª–æ–≤–æ –Ω–µ –≤–æ—Ä–æ–±–µ–π ‚Äî –≤—ã–ª–µ—Ç–∏—Ç, –Ω–µ –ø–æ–π–º–∞–µ—à—å', words: ['–°–ª–æ–≤–æ', '–Ω–µ', '–≤–æ—Ä–æ–±–µ–π', '‚Äî', '–≤—ã–ª–µ—Ç–∏—Ç,', '–Ω–µ', '–ø–æ–π–º–∞–µ—à—å'], distractors: ['—Ñ–ª–µ–∫—Å', '—Ö–∞–π–ø', '–∫—Ä–∏–Ω–∂', '—Ä–æ—Ñ–ª'] } }
    ];

    // --- –õ–û–ì–ò–ö–ê FIREBASE ---
    auth.onAuthStateChanged(user => {
      currentUser = user;
      if (user) {
        loadUserProgress(user.uid);
      }
      renderMenu();
    });

    function login() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(err => console.error(err));
    }

    function logout() {
      auth.signOut().then(() => { location.reload(); });
    }

    function saveProgressToFirebase() {
      if (currentUser) {
        db.ref('users/' + currentUser.uid).set({
          username: currentUser.displayName,
          photo: currentUser.photoURL,
          completed: completedEpisodes,
          score: completedEpisodes.length
        });
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
        db.ref('leaderboard/' + currentUser.uid).set({
          username: currentUser.displayName,
          score: completedEpisodes.length,
          photo: currentUser.photoURL
        });
      }
    }

    function loadUserProgress(uid) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const data = snapshot.val();
        if (data && data.completed) {
          completedEpisodes = data.completed;
          renderMenu();
        }
      });
    }

    function loadLeaderboard() {
      db.ref('leaderboard').orderByChild('score').limitToLast(10).once('value').then(snapshot => {
        leaderBoardData = [];
        snapshot.forEach(child => {
          leaderBoardData.unshift(child.val());
        });
        renderLeaderboard();
      });
    }

    // --- –†–ï–ù–î–ï–† –≠–ö–†–ê–ù–û–í ---
    function renderMenu() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <div class="h-full w-full flex flex-col items-center justify-center p-6 mountain-bg relative overflow-hidden">
          <div class="relative z-10 text-center max-w-2xl mx-auto">
            <h1 class="font-display text-5xl md:text-6xl font-bold mb-4 animate-slide-in" style="color: ${config.primary_action_color};">
              ${config.game_title}
            </h1>
            
            ${currentUser ? `
              <div class="mb-8 p-4 rounded-2xl flex items-center gap-4 bg-white/10 backdrop-blur-md animate-slide-in">
                <img src="${currentUser.photoURL}" class="w-12 h-12 rounded-full border-2 border-yellow-500">
                <div class="text-left">
                  <p class="text-sm opacity-70">–ü—Ä–∏–≤–µ—Ç, ${currentUser.displayName}</p>
                  <p class="font-bold text-yellow-500">–ü—Ä–æ–π–¥–µ–Ω–æ: ${completedEpisodes.length}/3</p>
                </div>
                <button onclick="logout()" class="ml-auto text-xs opacity-50 hover:opacity-100 underline">–í—ã–π—Ç–∏</button>
              </div>
            ` : `
              <button onclick="login()" class="mb-8 px-6 py-2 rounded-full bg-white text-black font-bold hover:scale-105 transition-all">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—á–∫–æ–≤
              </button>
            `}

            <div class="flex flex-col gap-4">
              <button onclick="startGame()" class="px-10 py-4 text-xl font-bold rounded-full bg-yellow-500 text-slate-900 animate-glow transition-all hover:scale-105">
                –ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç
              </button>
              <button onclick="loadLeaderboard()" class="px-10 py-3 text-lg font-semibold rounded-full bg-slate-700 text-white transition-all hover:bg-slate-600">
                üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderLeaderboard() {
      const app = document.getElementById('app');
      app.innerHTML = `
        <div class="h-full w-full p-6 mountain-bg flex flex-col items-center">
          <div class="max-w-md w-full animate-slide-in">
            <div class="flex items-center justify-between mb-8">
              <button onclick="renderMenu()" class="text-yellow-500">‚Üê –ú–µ–Ω—é</button>
              <h2 class="text-2xl font-bold text-yellow-500 font-display">–õ—É—á—à–∏–µ –∏–≥—Ä–æ–∫–∏</h2>
              <div></div>
            </div>
            <div class="bg-slate-800/80 rounded-3xl overflow-hidden backdrop-blur-lg">
              ${leaderBoardData.map((player, i) => `
                <div class="flex items-center gap-4 p-4 border-b border-white/5 ${i === 0 ? 'bg-yellow-500/10' : ''}">
                  <span class="text-xl font-bold w-6">${i + 1}</span>
                  <img src="${player.photo}" class="w-10 h-10 rounded-full">
                  <span class="flex-1 font-medium">${player.username}</span>
                  <span class="text-yellow-500 font-bold">${player.score} üèÜ</span>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // (–§—É–Ω–∫—Ü–∏–∏ startGame, renderEpisodeSelect –∏ –¥—Ä—É–≥–∏–µ –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –≤ —Ç–≤–æ–µ–º –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ)
    // –í–ê–ñ–ù–û: –í —Ñ—É–Ω–∫—Ü–∏–∏ completeEpisode(episodeId) –¥–æ–±–∞–≤—å –≤—ã–∑–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
    
    function completeEpisode(episodeId) {
      if (!completedEpisodes.includes(episodeId)) {
        completedEpisodes.push(episodeId);
        saveProgressToFirebase(); // <--- –î–æ–±–∞–≤–∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firebase
      }
      renderEpisodeSelect();
    }
    
    // –î—É–±–ª–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã
    function startGame() { renderEpisodeSelect(); }
    function renderEpisodeSelect() {
        const app = document.getElementById('app');
        // –¢–æ—Ç –∂–µ –∫–æ–¥, —á—Ç–æ –∏ –≤ —Ç–≤–æ–µ–º –ø—Ä–∏–º–µ—Ä–µ...
        app.innerHTML = `<div class="p-10">–≠–∫—Ä–∞–Ω—ã —ç–ø–∏–∑–æ–¥–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–π —Å–≤–æ–π —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –∑–¥–µ—Å—å)... <br><button onclick="renderMenu()" class="text-yellow-500 underline">–í –º–µ–Ω—é</button></div>`;
    }

    renderMenu();
  </script>
</body>
</html>